# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest

steps:
- script: git clone https://github.com/idosheffer/AutoRepo.git
  displayName: 'Run a one-line script'

- script: |
   sudo chmod 777 autoBash2.sh
   ./autoBash2.sh -u $(OKTAURL) -i $(OKTAID) -s $(OKTASECRET) -h $(POSTGRESHOST) -p $(POSTGRESPASSWORD) -n $(POSTGRESUSERNAME)
    echo Add other tasks to build, test, and deploy your project.
    echo See https://aka.ms/yaml
  displayName: 'Run a multi-line script'

- bash: |
      echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > .npmrc
      cd _build
      npm publish || true # Ignore publish failures, usually will happen because package already exists
  displayName: (azure-pipelines-task-lib) npm publish
  workingDirectory: node
  condition: and(succeeded(), in(variables['build.reason'], 'IndividualCI', 'BatchedCI', 'Manual'), eq(variables['build.sourcebranchname'], 'brunch'))
  env:
    NPM_TOKEN: $(npmPublishToken)
